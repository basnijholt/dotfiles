- defaults:
    link:
      create: true
      relink: true

- link:
    ~/.autoenv: submodules/autoenv
    ~/.bash_profile: configs/bash/bash_profile
    ~/.bashrc: configs/bash/bashrc
    ~/.condarc: configs/conda/condarc
    ~/.config/atuin: configs/atuin
    ~/.config/dask/distributed.yaml: configs/dask/distributed.yaml
    ~/.config/dotbins/config.yaml: submodules/dotbins/dotbins.yaml
    ~/.config/git/attributes: configs/git/attributes
    ~/.config/nix-darwin: configs/nix-darwin
    ~/.config/starship.toml: configs/starship/starship.toml
    ~/.direnvrc: configs/direnv/direnvrc
    ~/.dotbins: submodules/mydotbins
    ~/.gitconfig: configs/git/gitconfig
    ~/.local/bin/nbviewer: scripts/nbviewer.sh
    ~/.local/bin/pypi-sha256: scripts/pypi-sha256.sh
    ~/.local/bin/upload-file: scripts/upload-file.sh
    ~/.local/bin/run: scripts/run.sh
    ~/.local/bin/sync-dotfiles: scripts/sync-dotfiles.sh
    ~/.local/bin/sync-local-dotfiles: scripts/sync-local-dotfiles.sh
    ~/.local/bin/sync-uv-tools: scripts/sync-uv-tools.sh
    ~/.mambarc: configs/mamba/mambarc
    ~/.oh-my-zsh: submodules/oh-my-zsh
    ~/.tmux.conf: submodules/tmux/.tmux.conf
    ~/.tmux.conf.local: submodules/tmux/.tmux.conf.local
    ~/.zshrc: configs/zsh/zshrc
    ~/dotfiles/submodules/oh-my-zsh/themes/mytheme.zsh-theme: configs/zsh/mytheme.zsh-theme
    # Only on the machines with my ssh key
    ~/.gitconfig-sign:
      if: '[ "$(uname)" = "Darwin" ]'
      path: configs/git/gitconfig-sign
    # Only if on my Mac
    ~/.config/karabiner/karabiner.json:
      if: '[ "$(uname)" = "Darwin" ]'
      path: configs/karabiner/karabiner.json
    ~/Work/.stignore:
      if: '[ "$(uname)" = "Darwin" ]'
      path: configs/syncthing/stignore
    ~/dotfiles/.stignore:
      if: '[ "$(uname)" = "Darwin" ]'
      path: configs/syncthing/stignore
    ~/Lightroom/.stignore:
      if: '[ "$(uname)" = "Darwin" ]'
      path: configs/syncthing/stignore
    ~/Sync/.stignore:
      if: '[ "$(uname)" = "Darwin" ]'
      path: configs/syncthing/stignore
    "~/Library/Application Support/iTerm2/DynamicProfiles/Profiles.json":
      if: '[ "$(uname)" = "Darwin" ]'
      path: configs/iterm/Profiles.json

- shell:
  - bash scripts/sync-uv-tools.sh
  - git submodule sync --recursive
  - git submodule update --init --recursive --remote
  - command: '[[ "$(uname)" = "Darwin" ]] && [ -f ./secrets/install ] && (echo "SECRETS" && ./secrets/install) || true'
    stdout: true
